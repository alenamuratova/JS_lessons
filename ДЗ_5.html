<!DOCTYPE html>
<html>
<head>
	<title>Домашнее задание 5</title>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
</head>
<body>
<div class="container mt-4">
    <form class="add-product-form" action="#">
        <div class="form-group">
            <label for="commentText">Текст отзыва</label>
            <input type="text" class="form-control" id="commentText">
        </div>
        <div class="form-group">
            <label for="likes">Лайки</label>
            <input type="number" class="form-control" id="likes">
        </div>
        <button type="submit" class="btn btn-primary" onclick="getCommentText()">Добавить</button>
        <p>Здесь будут отзывы, которые попали сюда с сервера</p>
    </form>
    <h3 class="user-id mt-4"></h3>
    <ul class="list-group mt-4"></ul>
</div>



<script type="text/javascript">
const httpService = function() {
  	const BASE_URL = 'http://89.108.65.123:8080'; 

  	this.methods = {
    	GET: 'GET',
    	POST: 'POST',
    	DELETE: 'DELETE',
  	}

  	this.request = async function (url = '/', method = 'GET') { 
    	const options = { method } 

    try {
      	return await fetch(`${BASE_URL}${url}`, options).then((res) => {
        return res.json();
      	}).catch((err) => console.log(err))
    } 	catch (e) {
      	return false
    }
  	}
}



const $http = new httpService() 

const getComments = async (comment) => {
  if (comment) return await $http.request(`/comments?comment_id=${comment}`, $http.methods.GET) // если в аругменты был получен ID, то выполняем запрос и передаем ID(получим существущую корзину)
  return await $http.request('/comments', $http.methods.GET) // если ID нет, то выполняем запрос без параметров(тем самым создаем нового пользователя)
}

var commentID;

const init = async () => {
  	const comment = await getComments();
  	console.log(comment);

  	const body = document.querySelector('body');
  	var commentDiv = document.createElement('div');
  	commentDiv.className = 'div-class';
  	body.appendChild(commentDiv);

  	for (i = 0; i < comment.length; i++) {
  		var commentList = document.createElement('p');
  		commentList.className = 'my-class';
  		commentList.id = comment[i].comment_id;
  		commentList.innerHTML = 'ID:  ' + comment[i].comment_id +  '  ' + 'Текст:  ' + comment[i].text + '  ' + ' Лайки: ' + comment[i].likes;
  		commentDiv.appendChild(commentList);
  	}
}


if(init()) {

	document.addEventListener('click', function() {
		var elems = [ ...document.getElementsByClassName('my-class')];
		elems.forEach(function(element) {
			element.addEventListener('click', function() {
			commentID = this.getAttribute('id');
			console.log(commentID)
			});
		});
		const removeProduct = async (commentID) => {
  			await $http.request(`/comments?comment_id=${commentID}`, $http.methods.DELETE) // методы все забираем из нашего публичного поля methods
		}
	});

}


function getCommentText (){
	const like = document.querySelector('#likes').value;
	const commentText = document.querySelector('#commentText').value;
	console.log(commentText);
	console.log(like);

	const form = document.querySelector('.add-product-form');
	var newDiv = document.createElement('div');
    newDiv.innerHTML = commentText;
    form.appendChild(newDiv);
    var newDivLike = document.createElement('div');
    newDivLike.innerHTML = like;
    form.appendChild(newDivLike);

	$http.request(`/comments?text=${commentText}`, $http.methods.POST); // отправляет текст запроса на сервер
	//$http.request(`/comments?comment_id=_ynesyhxtf&likes=${like}&text=${commentText}`, $http.methods.POST);
}



</script>

</body>
</html>